<div class="profile-container">

  <div class="profile-section-card">
    <div class="section-header">
      <h2>{{ 'Profile.PersonalInfo' | translate }}</h2>
      <button mat-flat-button color="primary" (click)="toggleEditPersonalInfo()">
        <mat-icon>{{ personalInfoEditMode ? 'save' : 'edit' }}</mat-icon>
        {{ personalInfoEditMode ? ( 'Profile.Save' | translate ) : ( 'Profile.Edit' | translate ) }}
      </button>
    </div>

    <form [formGroup]="personalInfoForm" class="personal-info-content">
      <div class="profile-picture-container"
           (click)="onProfilePictureClick()"
           [class.editable]="personalInfoEditMode">
        <img [src]="personalInfoForm.get('profileImage')?.value" alt="Foto de Perfil">
        <span>{{ 'Profile.Photo' | translate }}</span>
      </div>

      <div class="personal-details">
        <mat-form-field appearance="outline">
          <mat-label>{{ 'Profile.Name' | translate }}</mat-label>
          <input matInput formControlName="name">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>{{ 'Profile.Email' | translate }}</mat-label>
          <input matInput type="email" formControlName="email">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>{{ 'Profile.Phone' | translate }}</mat-label>
          <input matInput formControlName="phone">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>{{ 'Profile.Address' | translate }}</mat-label>
          <input matInput formControlName="address">
        </mat-form-field>

        <button *ngIf="personalInfoEditMode"
                mat-stroked-button
                (click)="cancelEditPersonalInfo()"
                class="cancel-button">{{ 'Profile.Cancel' | translate }}</button>
      </div>
    </form>
  </div>

  <div class="profile-section-card">
    <h2>{{ 'Profile.Preferences' | translate }}</h2>
    <div class="preferences-grid">
      <mat-form-field appearance="outline">
        <mat-label>{{ 'Profile.PaymentMethods' | translate }}</mat-label>
        <mat-select [(ngModel)]="profileData.paymentMethod"
                    (selectionChange)="onPreferenceChanged('paymentMethod', $event.value)">
          <mat-option *ngFor="let method of paymentMethods" [value]="method">{{ method }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>{{ 'Profile.CurrentPassword' | translate }}</mat-label>
        <input matInput [type]="passwordVisible ? 'text' : 'password'" [value]="currentPassword" readonly>
        <button mat-icon-button matSuffix (click)="passwordVisible = !passwordVisible" type="button">
          <mat-icon>{{ passwordVisible ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>{{ 'Profile.PreferredBike' | translate }}</mat-label>
        <mat-select [(ngModel)]="profileData.preferredBikeType"
                    (selectionChange)="onPreferenceChanged('preferredBikeType', $event.value)">
          <mat-option *ngFor="let type of bikeTypes" [value]="type">{{ type }}</mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-flat-button color="primary" class="change-password-button">
        {{ 'Profile.ChangePassword' | translate }}
      </button>

      <div class="notifications-toggle">
        <label>{{ 'Profile.Notifications' | translate }}</label>
        <mat-slide-toggle
          [(ngModel)]="profileData.notifications"
          (change)="onPreferenceChanged('notifications', $event.checked)">
        </mat-slide-toggle>
      </div>
    </div>
  </div>
  <div class="profile-section-card">
    <h2>{{ 'Profile.MyReviews' | translate }}</h2>
    <div class="reviews-container">
      <mat-card class="review-card" *ngFor="let item of [1, 2, 3]">
        <mat-card-header>
          <div mat-card-avatar class="review-avatar"></div>
          <mat-card-title>Martin</mat-card-title>
          <mat-card-subtitle>BMK - San Miguel</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p class="review-date">28 de junio 2025</p>
          <p>"El usuario entreg√≥ la bicicleta en buen estado"</p>
        </mat-card-content>
        <mat-card-actions class="review-rating">
          <div class="rating-stars">
            <strong>4.8</strong>
            <mat-icon *ngFor="let star of stars; let i = index">{{ getStarType(4.8, i + 1) }}</mat-icon>
          </div>
        </mat-card-actions>
      </mat-card>
    </div>
    <div class="view-more-container">
      <button mat-flat-button color="primary">{{ 'Profile.ViewMore' | translate }}</button>
    </div>
  </div>
</div>
